<form [formGroup]="movieForm" (ngSubmit)="onSubmit()" novalidate>
  <fieldset class="border p-3">
    <legend class="w-auto">{{ isEditMode ? 'Editar' : 'Cadastrar novo' }} filme</legend>
    <div class="form-row">

      <div class="form-group">
        <label for="title">Titulo</label>
        <input
          type="text"
          id="title"
          class="form-control"
          [ngClass]="{'is-invalid': control('title').touched && control('title').invalid}"
          formControlName="title"
        />
        <div class="invalid-feedback">
          @if(control('title').touched && control('title').hasError('required')) { <div>Titulo é obrigatório.</div> }
          @if(control('title').touched && control('title').hasError('maxlength')) { <div>Tamanho maximo atigingido (70 caracteres).</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="genre">Gênero</label>
        <input
          type="text"
          id="genre"
          class="form-control"
          [ngClass]="{'is-invalid': control('genre').touched && control('genre').invalid}"
          formControlName="genre"
        />
        <div class="invalid-feedback">
          @if(control('genre').touched && control('genre').hasError('required')) { <div>Gênero é obrigatório.</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="platform">Plataforma</label>
        <input
          type="text"
          id="platform"
          class="form-control"
          [ngClass]="{'is-invalid': control('platform').touched && control('platform').invalid}"
          formControlName="platform"
        />
        <div class="invalid-feedback">
          @if(control('platform').touched && control('platform').hasError('required')) { <div>platforma é obrigatório.</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="price">Preço (R$)</label>
        <input
          type="number"
          id="price"
          class="form-control"
          [ngClass]="{'is-invalid': control('price').touched && control('price').invalid}"
          formControlName="price"
          step="0.01"
        />
        <div class="invalid-feedback">
          @if(control('price').touched && control('price').hasError('required')) { <div>Preço é obrigatório.</div> }
          @if(control('price').touched && control('price').hasError('min')) { <div>Preço deve ser maior que 0.</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="description">Descrição</label>
        <textarea
          type="text"
          id="description"
          class="form-control"
          [ngClass]="{'is-invalid': control('description').touched && control('description').invalid}"
          formControlName="description"
        ></textarea>
        <div class="invalid-feedback">
          @if(control('description').touched && control('description').hasError('required')) { <div>Descrição é obrigatório.</div> }
          @if(control('description').touched && control('description').hasError('maxlength')) { <div>Tamanho maximo atigingido (300 caracteres).</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="availableInStock">Estoque</label>
        <input
          type="number"
          id="availableInStock"
          class="form-control"
          [ngClass]="{'is-invalid': control('availableInStock').touched && control('availableInStock').invalid}"
          formControlName="availableInStock"
          step="1.0"
        />
        <div class="invalid-feedback">
          @if(control('availableInStock').touched && control('availableInStock').hasError('required')) { <div>Estoque é obrigatório.</div> }
          @if(control('availableInStock').touched && control('availableInStock').hasError('min')) { <div>Estoque deve ser maior que 0.</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="image" class="form-label">Poster</label>
        <input class="form-control" type="file" id="image" (change)="onFileSelected($event)">

        @if (imagePreview) {
          <span>Pré-visualização:</span>
          <div class="preview">
            <img [src]="imagePreview" alt="Preview" style="max-width: 240px; margin-top: 8px;" />
          </div>
        }
      </div>
    </div>
    <div>
      @if (!isEditMode) {
        <button type="submit" class="btn btn-outline-primary btn-block mt-3" [disabled]="!movieForm.valid || !selectedFile">Cadastrar</button>
        <button type="button" class="btn btn-outline-secondary btn-block mt-3" (click)="formClear()">Limpar Todos os Campos</button>
      } @else {
        <button type="submit" class="btn btn-primary btn-block mt-3" [disabled]="!movieForm.valid">Salvar Alterações</button>
      }

      <button type="button" class="btn btn-secondary btn-block mt-3" [routerLink]="['/home']">Cancelar</button>
    </div>

  </fieldset>
</form>
