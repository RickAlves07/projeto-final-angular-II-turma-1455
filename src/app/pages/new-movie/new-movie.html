<form [formGroup]="movieForm" (ngSubmit)="onSubmit()" novalidate>
  <fieldset class="border p-3">
    @if (isEditMode) {
      <legend class="w-auto">{{ 'newMovie.PageTitleEdit' | translate }}: {{ movieForm.get('title')?.value | uppercase }}</legend>
    } @else {
      <legend class="w-auto">{{ 'newMovie.PageTitleAdd' | translate }}</legend>
    }
    <div class="form-row">

      <div class="form-group">
        <label for="title">{{ 'newMovie.form.title' | translate }}</label>
        <input
          type="text"
          id="title"
          class="form-control"
          [ngClass]="{'is-invalid': control('title').touched && control('title').invalid}"
          formControlName="title"
        />
        <div class="invalid-feedback">
          @if(control('title').touched && control('title').hasError('required')) { <div>{{ 'newMovie.form.titleRequired' | translate }}</div> }
          @if(control('title').touched && control('title').hasError('maxlength')) { <div>{{ 'newMovie.form.titleMaxlength' | translate }}</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="genre">{{ 'newMovie.form.genre' | translate }}</label>
        <input
          type="text"
          id="genre"
          class="form-control"
          [ngClass]="{'is-invalid': control('genre').touched && control('genre').invalid}"
          formControlName="genre"
        />
        <div class="invalid-feedback">
          @if(control('genre').touched && control('genre').hasError('required')) { <div>{{ 'newMovie.form.genreRequired' | translate }}</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="platform">{{ 'newMovie.form.platform' | translate }}</label>
        <input
          type="text"
          id="platform"
          class="form-control"
          [ngClass]="{'is-invalid': control('platform').touched && control('platform').invalid}"
          formControlName="platform"
        />
        <div class="invalid-feedback">
          @if(control('platform').touched && control('platform').hasError('required')) { <div>{{ 'newMovie.form.platformRequired' | translate }}</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="price">{{ 'newMovie.form.price' | translate }}</label>
        <input
          type="number"
          id="price"
          class="form-control"
          [ngClass]="{'is-invalid': control('price').touched && control('price').invalid}"
          formControlName="price"
          step="0.01"
        />
        <div class="invalid-feedback">
          @if(control('price').touched && control('price').hasError('required')) { <div>{{ 'newMovie.form.priceRequired' | translate }}</div> }
          @if(control('price').touched && control('price').hasError('min')) { <div>{{ 'newMovie.form.priceMin' | translate }}</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="description">{{ 'newMovie.form.description' | translate }}</label>
        <textarea
          type="text"
          id="description"
          class="form-control"
          [ngClass]="{'is-invalid': control('description').touched && control('description').invalid}"
          formControlName="description"
        ></textarea>
        <div class="invalid-feedback">
          @if(control('description').touched && control('description').hasError('required')) { <div>{{ 'newMovie.form.descriptionRequired' | translate }}</div> }
          @if(control('description').touched && control('description').hasError('maxlength')) { <div>{{ 'newMovie.form.descriptionMaxlength' | translate }}</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="availableInStock">{{ 'newMovie.form.stock' | translate }}</label>
        <input
          type="number"
          id="availableInStock"
          class="form-control"
          [ngClass]="{'is-invalid': control('availableInStock').touched && control('availableInStock').invalid}"
          formControlName="availableInStock"
          step="1.0"
        />
        <div class="invalid-feedback">
          @if(control('availableInStock').touched && control('availableInStock').hasError('required')) { <div>{{ 'newMovie.form.stockRequired' | translate }}</div> }
          @if(control('availableInStock').touched && control('availableInStock').hasError('min')) { <div>{{ 'newMovie.form.stockMin' | translate }}</div> }
        </div>
      </div>

      <div class="form-group">
        <label for="image" class="form-label">{{ 'newMovie.form.image' | translate }}</label>
        <input class="form-control" type="file" id="image" (change)="onFileSelected($event)" >

        @if (imagePreview) {
          <span>{{ 'newMovie.form.imagePreview' | translate }}:</span>
          <div class="preview">
            <img [src]="imagePreview" alt="Preview" style="max-width: 240px; margin-top: 8px;" />
          </div>
        }
      </div>
    </div>
    <div>
      @if (!isEditMode) {
        <button type="submit" class="btn btn-outline-primary btn-block mt-3" [disabled]="!movieForm.valid || !selectedFile">{{ 'newMovie.form.submit' | translate }}</button>
        <button type="button" class="btn btn-outline-secondary btn-block mt-3" (click)="formClear()">{{ 'newMovie.form.cleanFields' | translate }}</button>
      } @else {
        <button type="submit" class="btn btn-primary btn-block mt-3" [disabled]="!movieForm.valid">{{ 'newMovie.form.editSubmit' | translate }}</button>
      }

      <button type="button" class="btn btn-secondary btn-block mt-3" [routerLink]="['/home']">{{ 'newMovie.form.cancel' | translate }}</button>
    </div>

  </fieldset>
</form>
